<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Renkli Ajanda - Pro</title>
    <style>
        :root {
            --bg: #F4F7F9; --card: #FFFFFF; --text: #2D3436; --line: #CBD5E0;
            --pzt: #FFEBEE; --sal: #E3F2FD; --car: #F1F8E9; --per: #FFF3E0; --cum: #F3E5F5; --cmt: #E0F7FA; --paz: #FFFDE7;
            --pzt-b: #EF5350; --sal-b: #42A5F5; --car-b: #9CCC65; --per-b: #FFB74D; --cum-b: #AB47BC; --cmt-b: #26C6DA; --paz-b: #FBC02D;
        }

        [data-theme="dark"] {
            --bg: #1A202C; --card: #2D3748; --text: #F7FAFC; --line: #4A5568;
            --pzt: #442727; --sal: #233044; --car: #223020; --per: #443320; --cum: #332344; --cmt: #203344; --paz: #444420;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; justify-content: center; height: 100vh; overflow: hidden; }

        .app-wrapper { width: 100vw; max-width: 450px; padding: 12px; height: 100vh; display: flex; flex-direction: column; }

        .wordart { font-size: 28px; font-weight: 900; background: linear-gradient(#3B82F6, #1D4ED8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
        .app-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .today-banner { text-align: center; font-size: 13px; font-weight: 800; color: #1D4ED8; margin-top: -5px; }
        
        .circle-btn { width: 40px; height: 40px; border-radius: 12px; border: none; background: var(--card); color: var(--text); box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; font-size: 18px; }

        .nav-control { background: var(--card); border-radius: 30px; padding: 8px 18px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .arrow-btn { background: rgba(0,0,0,0.05); color: var(--text); border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-weight: bold; }

        .week-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; flex: 1; margin-bottom: 5px; }
        .pazar-card { grid-column: span 2 !important; }

        .day-card {
            background: var(--card); border-radius: 18px; padding: 8px 12px;
            min-height: 85px; 
            border-left: 8px solid var(--line);
            display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            overflow: hidden;
        }
        
        .is-today { border: 3px solid #1D4ED8 !important; box-shadow: 0 0 12px rgba(29, 78, 216, 0.4) !important; z-index: 5; }
        
        .d-num { font-size: 22px; font-weight: 900; line-height: 1; }
        .d-name { font-size: 10px; font-weight: 700; opacity: 0.6; text-transform: uppercase; }
        
        .d-body { flex: 1; margin-top: 4px; }
        
        .d-line { 
            border-bottom: 1px solid var(--line); height: 19px; outline: none; 
            font-size: 11px; line-height: 19px; overflow: hidden; white-space: nowrap; 
            text-overflow: ellipsis;
        }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { width: 90vw; max-width: 400px; height: 80vh; background: var(--card); border-radius: 25px; display: flex; flex-direction: column; border-left: 15px solid var(--line); }
        .modal-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--line); }
        
        /* G√úN GE√áƒ∞≈û BUTONLARI CSS */
        .day-nav-wrapper { display: flex; align-items: center; gap: 10px; }
        .nav-modal-btn { background: #f1f5f9; border: none; width: 32px; height: 32px; border-radius: 10px; cursor: pointer; color: #1D4ED8; font-weight: bold; }

        .notebook-full-page { flex: 1; padding: 10px 20px; outline: none; margin: 15px; border-radius: 15px; background: linear-gradient(transparent 34px, var(--line) 35px); background-size: 100% 35px; line-height: 35px; font-size: 16px; overflow-y: auto; border: 1px solid var(--line); }

        .quick-panel { background: var(--card); border-radius: 25px; padding: 25px; display: flex; flex-direction: column; gap: 15px; width: 90vw; max-width: 400px; }
        .form-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .form-grid input, .form-grid select { padding: 12px; border-radius: 10px; border: 1px solid var(--line); background: var(--bg); color: var(--text); flex: 1; min-width: 45%; }
        .full-w { min-width: 100% !important; }
        .check-row-fixed { display: flex; width: 100%; gap: 10px; }
        .opt-label { flex: 1; background: #f1f5f9; padding: 12px; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 12px; font-weight: 700; cursor: pointer; }

        .primary-btn { background: #1D4ED8; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .cancel-btn { background: transparent; color: #cc0000; border: none; padding: 5px; font-weight: 900; font-size: 16px; cursor: pointer; text-decoration: underline; }

        .day-0 { background: var(--pzt); border-left-color: var(--pzt-b); }
        .day-1 { background: var(--sal); border-left-color: var(--sal-b); }
        .day-2 { background: var(--car); border-left-color: var(--car-b); }
        .day-3 { background: var(--per); border-left-color: var(--per-b); }
        .day-4 { background: var(--cum); border-left-color: var(--cum-b); }
        .day-5 { background: var(--cmt); border-left-color: var(--cmt-b); }
        .day-6 { background: var(--paz); border-left-color: var(--paz-b); }

        .master-table { width: 100%; border-collapse: collapse; }
        .master-table td { padding: 12px 8px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
    </style>
</head>
<body data-theme="light">

    <div class="app-wrapper">
        <header class="app-header">
            <div>
                <h1 class="wordart">Hafta Planƒ±</h1>
                <div id="todayBanner" class="today-banner"></div>
            </div>
            <div class="header-btns">
                <button id="themeToggle" class="circle-btn">üåì</button>
                <button id="masterListBtn" class="circle-btn">üìä</button>
                <button id="quickAddBtn" class="circle-btn">üîî</button>
            </div>
        </header>

        <nav class="nav-control">
            <button id="prevWeek" class="arrow-btn">‚ùÆ</button>
            <div id="dateDisplay" style="font-weight: 800; font-size: 14px;">...</div>
            <button id="nextWeek" class="arrow-btn">‚ùØ</button>
        </nav>

        <main class="week-grid" id="weekGrid"></main>
    </div>

    <div id="dayModal" class="modal">
        <div class="modal-content" id="modalFrame">
            <header class="modal-header">
                <button class="cancel-btn" style="font-size:12px;" onclick="closeAllModals()">ƒ∞PTAL</button>
                <div class="day-nav-wrapper">
                    <button class="nav-modal-btn" onclick="changeDay(-1)">‚ùÆ</button>
                    <h2 id="modalFullHeader" style="font-size:14px; font-weight: 800; color: #1D4ED8; min-width: 100px; text-align: center;"></h2>
                    <button class="nav-modal-btn" onclick="changeDay(1)">‚ùØ</button>
                </div>
                <button id="saveDayBtn" class="primary-btn" style="padding:5px 15px;">KAYDET</button>
            </header>
            <div class="notebook-full-page" id="modalLines" contenteditable="true"></div>
        </div>
    </div>

    <div id="quickAddModal" class="modal">
        <div class="quick-panel">
            <div style="background:#1D4ED8; color:white; padding:10px; border-radius:10px; text-align:center; font-weight:800;">üîî Yeni Etkinlik & Alarm</div>
            <div class="form-grid">
                <input type="date" id="qaDate">
                <input type="time" id="qaTime">
                <input type="text" id="qaText" placeholder="Etkinlik adƒ±..." class="full-w">
                <select id="qaImportance" class="full-w">
                    <option value="‚ö™">‚ö™ D√º≈ü√ºk</option>
                    <option value="üü°">üü° Orta</option>
                    <option value="üî¥">üî¥ Acil</option>
                </select>
                <div class="check-row-fixed">
                    <label class="opt-label"><input type="checkbox" id="qaAlarm" checked> Alarm</label>
                    <label class="opt-label"><input type="checkbox" id="qaRepeat"> Her Hafta</label>
                </div>
            </div>
            <button id="qaSaveBtn" class="primary-btn">TAKVƒ∞ME ƒ∞≈ûLE</button>
            <button class="cancel-btn" onclick="closeAllModals()">VAZGE√á</button>
        </div>
    </div>

    <div id="masterListModal" class="modal">
        <div class="modal-content" style="border-left-color: #1D4ED8;">
            <header class="modal-header">
                <span style="font-weight:900;">üìä PLANLI ETKƒ∞NLƒ∞KLER</span>
                <button class="cancel-btn" style="font-size:12px;" onclick="closeAllModals()">KAPAT</button>
            </header>
            <div class="notebook-full-page">
                <table class="master-table"><tbody id="masterListContent"></tbody></table>
            </div>
        </div>
    </div>

    <audio id="alarmSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <script>
        const toKey = (date) => {
            const d = new Date(date);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        };

        let currentWeekStart = new Date();
        const setMon = (date) => {
            let day = date.getDay();
            let diff = date.getDate() - day + (day === 0 ? -6 : 1);
            date.setDate(diff);
        };
        setMon(currentWeekStart);

        let agenda = JSON.parse(localStorage.getItem('elite_vFinal_v2')) || { events: [], notes: {} };
        let activeKey = null;

        const trDays = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        const trMonths = ["Ocak", "≈ûubat", "Mart", "Nisan", "Mayƒ±s", "Haziran", "Temmuz", "Aƒüustos", "Eyl√ºl", "Ekim", "Kasƒ±m", "Aralƒ±k"];

        document.addEventListener('DOMContentLoaded', () => {
            renderUI();
            setupEvents();
            setInterval(checkAlarms, 30000);
        });

        function renderUI() {
            const grid = document.getElementById('weekGrid');
            grid.innerHTML = '';
            const todayKey = toKey(new Date());
            document.getElementById('dateDisplay').innerText = `${trMonths[currentWeekStart.getMonth()]} ${currentWeekStart.getFullYear()}`;
            document.getElementById('todayBanner').innerText = `${new Date().getDate()} ${trMonths[new Date().getMonth()]} ${trDays[new Date().getDay() === 0 ? 6 : new Date().getDay()-1]}`;

            for (let i = 0; i < 7; i++) {
                let d = new Date(currentWeekStart);
                d.setDate(currentWeekStart.getDate() + i);
                let key = toKey(d);
                
                let dayNotes = (agenda.notes[key] || "").split('\n');
                let dayEvents = agenda.events.filter(ev => ev.date === key || (ev.repeat && new Date(ev.date).getDay() === d.getDay()));
                let eventLines = dayEvents.map(ev => `${ev.imp} ${ev.time} ${ev.text}`);
                let combined = [...eventLines, ...dayNotes].filter(x => x.trim() !== "");

                const card = document.createElement('div');
                card.className = `day-card day-${i} ${i === 6 ? 'pazar-card' : ''} ${key === todayKey ? 'is-today' : ''}`;
                card.innerHTML = `
                    <div class="d-head" onclick="openDay('${key}', ${i})">
                        <div class="d-num">${d.getDate()}</div>
                        <div class="d-name">${trDays[i]}</div>
                    </div>
                    <div class="d-body">
                        ${[0, 1, 2, 3].map(idx => `
                            <div class="d-line" contenteditable="true" onblur="saveQuick('${key}', this)">${combined[idx] || ''}</div>
                        `).join('')}
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function setupEvents() {
            document.getElementById('themeToggle').onclick = () => document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
            document.getElementById('prevWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate() - 7); renderUI(); };
            document.getElementById('nextWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate() + 7); renderUI(); };
            document.getElementById('quickAddBtn').onclick = () => {
                document.getElementById('qaDate').value = toKey(new Date());
                document.getElementById('quickAddModal').style.display = 'flex';
            };
            document.getElementById('qaSaveBtn').onclick = () => {
                const date = document.getElementById('qaDate').value;
                const time = document.getElementById('qaTime').value;
                const text = document.getElementById('qaText').value;
                const imp = document.getElementById('qaImportance').value;
                const repeat = document.getElementById('qaRepeat').checked;
                const alarm = document.getElementById('qaAlarm').checked;
                if(!date || !text) return;
                agenda.events.push({ id: Date.now(), date, time, text, imp, repeat, alarm, fired: false });
                save(); renderUI(); closeAllModals();
            };
            document.getElementById('saveDayBtn').onclick = () => {
                agenda.notes[activeKey] = document.getElementById('modalLines').innerText;
                save(); renderUI(); closeAllModals();
            };
            document.getElementById('masterListBtn').onclick = renderMaster;
        }

        function openDay(key, dayIdx) {
            activeKey = key;
            const d = new Date(key);
            // dayIdx parametresi gelmezse (navigasyondan gelirse) hesapla
            const calculatedDayIdx = d.getDay() === 0 ? 6 : d.getDay() - 1;
            
            document.getElementById('modalFrame').className = `modal-content day-${calculatedDayIdx}`;
            document.getElementById('modalFullHeader').innerText = key + " " + trDays[calculatedDayIdx];
            document.getElementById('modalLines').innerText = agenda.notes[key] || "";
            document.getElementById('dayModal').style.display = 'flex';
        }

        // G√úNLER ARASI GE√áƒ∞≈û FONKSƒ∞YONU
        function changeDay(offset) {
            let current = new Date(activeKey);
            current.setDate(current.getDate() + offset);
            let newKey = toKey(current);
            openDay(newKey);
        }

        function renderMaster() {
            const cont = document.getElementById('masterListContent');
            cont.innerHTML = "";
            let sorted = [...agenda.events].sort((a,b) => a.date.localeCompare(b.date));
            sorted.forEach(ev => {
                cont.innerHTML += `<tr>
                    <td onclick="manageEv(${ev.id})" style="cursor:pointer; font-size:18px;">${ev.imp}</td>
                    <td><b>${ev.date}</b></td>
                    <td>${ev.time} - ${ev.text} ${ev.repeat ? 'üîÑ' : ''}</td>
                </tr>`;
            });
            document.getElementById('masterListModal').style.display = 'flex';
        }

        function manageEv(id) {
            const idx = agenda.events.findIndex(e => e.id === id);
            if(confirm(`"${agenda.events[idx].text}" silinsin mi?`)) {
                agenda.events.splice(idx, 1);
                save(); renderUI(); renderMaster();
            }
        }

        function checkAlarms() {
            const now = new Date();
            const curT = String(now.getHours()).padStart(2,'0')+":"+String(now.getMinutes()).padStart(2,'0');
            const curK = toKey(now);
            agenda.events.forEach(ev => {
                if(ev.alarm && ev.date === curK && ev.time === curT && !ev.fired) {
                    document.getElementById('alarmSound').play();
                    alert("HATIRLATICI: " + ev.text);
                    ev.fired = true;
                    setTimeout(() => ev.fired = false, 61000);
                }
            });
        }

        function save() { localStorage.setItem('elite_vFinal_v2', JSON.stringify(agenda)); }
        function saveQuick(key, el) {
            const lines = Array.from(el.parentElement.querySelectorAll('.d-line')).map(l => l.innerText);
            agenda.notes[key] = lines.filter(line => !line.includes('‚ö™') && !line.includes('üü°') && !line.includes('üî¥')).join('\n');
            save();
        }
        function closeAllModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    </script>
</body>
</html>