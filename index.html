<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Renkli Ajanda - Pro v2026</title>
    <style>
        :root {
            --bg: #F4F7F9; --card: #FFFFFF; --text: #2D3436; --line: #CBD5E0;
            --pzt: #FFEBEE; --sal: #E3F2FD; --car: #F1F8E9; --per: #FFF3E0; --cum: #F3E5F5; --cmt: #E0F7FA; --paz: #FFFDE7;
            --pzt-b: #EF5350; --sal-b: #42A5F5; --car-b: #9CCC65; --per-b: #FFB74D; --cum-b: #AB47BC; --cmt-b: #26C6DA; --paz-b: #FBC02D;
        }

        [data-theme="dark"] {
            --bg: #1A202C; --card: #2D3748; --text: #F7FAFC; --line: #4A5568;
            --pzt: #442727; --sal: #233044; --car: #223020; --per: #443320; --cum: #332344; --cmt: #203344; --paz: #444420;
        }

        /* ZEMƒ∞N YAPILARI */
        .f-lined { background: linear-gradient(transparent 34px, var(--line) 35px) !important; background-size: 100% 35px !important; }
        .f-squared { background-image: linear-gradient(var(--line) 1px, transparent 1px), linear-gradient(90deg, var(--line) 1px, transparent 1px) !important; background-size: 25px 25px !important; }
        .f-dotted { background-image: radial-gradient(var(--line) 1px, transparent 1px) !important; background-size: 25px 25px !important; }
        .f-blank { background: transparent !important; }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; justify-content: center; height: 100vh; overflow: hidden; transition: 0.3s; }

        #loginOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .login-box { background: var(--card); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 350px; text-align: center; }

        .app-wrapper { width: 100vw; max-width: 450px; padding: 12px; height: 100vh; display: flex; flex-direction: column; position: relative; display: none; }
        .wordart { font-size: 32px; font-weight: 900; background: linear-gradient(#3B82F6, #1D4ED8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
        .today-banner { text-align: center; font-size: 18px; font-weight: 800; color: #1D4ED8; margin: 5px 0 10px 0; }
        
        .circle-btn { width: 40px; height: 40px; border-radius: 12px; border: none; background: var(--card); color: var(--text); box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }

        .side-panel { position: absolute; right: -320px; top: 0; width: 300px; height: 100%; background: var(--bg); z-index: 2000; box-shadow: -5px 0 20px rgba(0,0,0,0.2); transition: 0.4s; padding: 20px; display: flex; flex-direction: column; border-left: 10px solid #1D4ED8; overflow-y: auto; }
        .side-panel.active { right: 0; }
        .panel-close { position: absolute; left: -45px; top: 20px; background: #1D4ED8; color: white; border: none; width: 45px; height: 45px; border-radius: 12px 0 0 12px; cursor: pointer; font-size: 20px; }

        .profile-card { background: var(--card); border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border-bottom: 5px solid #1D4ED8; }
        .profile-img { width: 90px; height: 90px; border-radius: 50%; background: #eee; margin: 0 auto 15px; display: block; object-fit: cover; border: 4px solid #1D4ED8; cursor: pointer; }
        .prof-input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid var(--line); border-radius: 10px; background: var(--bg); color: var(--text); font-size: 14px; }

        .nav-control { background: var(--card); border-radius: 30px; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .arrow-btn { background: rgba(0,0,0,0.05); color: var(--text); border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; }

        .week-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; flex: 1; margin-bottom: 5px; overflow-y: auto; }
        .pazar-card { grid-column: span 2 !important; }

        .day-card { background: var(--card); border-radius: 20px; padding: 12px; min-height: 140px; border-left: 8px solid var(--line); display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: relative; }
        .is-today { border: 3px solid #1D4ED8 !important; }
        .d-num { font-size: 26px; font-weight: 900; line-height: 1; }
        .d-name { font-size: 11px; font-weight: 700; opacity: 0.7; text-transform: uppercase; margin-bottom: 5px; }
        
        .not-lines { flex: 1; line-height: 24px; font-size: 12px; outline: none; min-height: 72px; height: 72px; overflow: hidden; margin-top: 5px; pointer-events: none; }
        
        /* ETKƒ∞NLƒ∞K TASARIMI */
        .day-event-item { font-size: 10px; font-weight: 800; background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 4px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }

        .format-bar { display: flex; gap: 5px; padding: 10px; background: #eee; border-radius: 10px; margin-bottom: 5px; align-items: center; overflow-x: auto; }
        .format-btn { min-width: 32px; height: 32px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 5px; font-size: 14px; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .color-dot { width: 20px; height: 20px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; flex-shrink: 0; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); display: none; z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { width: 95vw; max-width: 420px; height: 85vh; background: var(--card); border-radius: 30px; display: flex; flex-direction: column; border-left: 15px solid var(--line); overflow: hidden; }
        .modal-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--line); }
        
        /* NOTEBOOK VE RESƒ∞M √ñZELLƒ∞ƒûƒ∞ */
        .notebook-page { flex: 1; padding: 25px; outline: none; line-height: 35px; font-size: 17px; overflow-y: auto; position: relative; }
        .notebook-page img { 
            display: inline-block; 
            max-width: 100%; 
            border-radius: 10px; 
            margin: 10px 0; 
            resize: both; /* √áekerek b√ºy√ºtme √∂zelliƒüi */
            overflow: auto; 
            border: 2px dashed transparent; 
            vertical-align: bottom;
            cursor: nwse-resize;
        }
        .notebook-page img:focus { border-color: #1D4ED8; outline: none; }

        #masterListContent { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        #masterListContent tr { background: #f8f9fa; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        #masterListContent td { padding: 12px; font-size: 13px; font-weight: 600; }

        #alarmOverlay { position: fixed; inset: 0; background: rgba(29, 78, 216, 0.95); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; padding: 20px; }
        .primary-btn { background: #1D4ED8; color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%; }

        .day-0 { background: var(--pzt); border-left-color: var(--pzt-b); }
        .day-1 { background: var(--sal); border-left-color: var(--sal-b); }
        .day-2 { background: var(--car); border-left-color: var(--car-b); }
        .day-3 { background: var(--per); border-left-color: var(--per-b); }
        .day-4 { background: var(--cum); border-left-color: var(--cum-b); }
        .day-5 { background: var(--cmt); border-left-color: var(--cmt-b); }
        .day-6 { background: var(--paz); border-left-color: var(--paz-b); }
    </style>
</head>
<body data-theme="light">

    <div id="loginOverlay">
        <div class="login-box">
            <h1 class="wordart" style="margin-bottom:20px;">Elite Giri≈ü</h1>
            <input type="email" id="logEmail" class="prof-input" placeholder="Mail Adresiniz">
            <input type="password" id="logPass" class="prof-input" placeholder="≈ûifreniz">
            <button class="primary-btn" onclick="tryLogin()">Gƒ∞Rƒ∞≈û YAP</button>
        </div>
    </div>

    <div id="alarmOverlay">
        <div style="font-size:80px;">üîî</div>
        <h1 style="font-size: 30px; margin: 20px 0;">HATIRLATICI!</h1>
        <div id="alarmInfo" style="font-size: 20px; font-weight: bold; margin-bottom: 30px;"></div>
        <button onclick="stopAlarm()" class="primary-btn" style="background: white; color: #1D4ED8; width: 200px;">TAMAM</button>
        <audio id="alarmAudio" loop src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    </div>

    <div id="sidePanel" class="side-panel">
        <button class="panel-close" onclick="togglePanel()">üë§</button>
        <h2 class="wordart" style="font-size: 24px; margin-bottom: 20px;">Profilim</h2>
        <div class="profile-card">
            <label for="profPicInput"><img id="profImg" src="https://via.placeholder.com/100" class="profile-img"></label>
            <input type="file" id="profPicInput" style="display:none" onchange="loadProfilePic(event)">
            <input type="text" id="profName" class="prof-input" placeholder="Ad Soyad">
            <input type="text" id="profPhone" class="prof-input" placeholder="Telefon">
            <input type="email" id="profEmail" class="prof-input" placeholder="E-posta" readonly>
            <textarea id="profBio" class="prof-input" style="height:80px;" placeholder="Notlar..."></textarea>
            
            <label style="font-size:12px; font-weight:bold; margin-bottom:5px; display:block;">SAYFA YAPISI:</label>
            <select id="pageFormat" class="prof-input" onchange="updatePageFormat(this.value)">
                <option value="f-blank">D√ºz (Sadece Renk)</option>
                <option value="f-lined">√áizgili</option>
                <option value="f-squared">Kareli</option>
                <option value="f-dotted">Noktalƒ±</option>
            </select>

            <button class="primary-btn" onclick="saveProfile()" style="padding:10px;">G√úNCELLE</button>
        </div>
        <button onclick="handleLogout()" style="width:100%; border:none; background:none; color:#cc0000; font-weight:bold; cursor:pointer; text-decoration:underline;">Oturumu Kapat</button>
    </div>

    <div class="app-wrapper" id="mainApp">
        <header style="display:flex; justify-content:space-between; align-items:center;">
            <h1 class="wordart">Hafta Planƒ±</h1>
            <div style="display:flex; gap:8px;">
                <button id="themeToggle" class="circle-btn">üåì</button>
                <button onclick="togglePanel()" class="circle-btn">‚öôÔ∏è</button>
                <button id="masterListBtn" class="circle-btn">üìä</button>
                <button id="quickAddBtn" class="circle-btn">üîî</button>
            </div>
        </header>
        <div id="todayBanner" class="today-banner"></div>
        <nav class="nav-control">
            <button id="prevWeek" class="arrow-btn">‚ùÆ</button>
            <div id="dateDisplay" style="font-weight: 900; color:#1D4ED8;"></div>
            <button id="nextWeek" class="arrow-btn">‚ùØ</button>
        </nav>
        <main class="week-grid" id="weekGrid"></main>
    </div>

    <div id="dayModal" class="modal">
        <div class="modal-content" id="modalFrame">
            <header class="modal-header">
                <button class="arrow-btn" onclick="navigateDay(-1)">‚ùÆ</button>
                <div style="text-align:center">
                    <h2 id="modalFullHeader" style="font-size:14px; margin-bottom:5px;"></h2>
                    <div id="dayEventsHeader" style="display:flex; gap:4px; flex-wrap:wrap; justify-content:center;"></div>
                </div>
                <button class="arrow-btn" onclick="navigateDay(1)">‚ùØ</button>
                <button id="saveDayBtn" class="primary-btn" style="width:auto; padding:5px 15px;">KAYDET</button>
                <button onclick="closeAllModals()" style="border:none; background:none; color:red; font-size:18px; margin-left:10px;">‚úï</button>
            </header>
            
            <div class="format-bar">
                <button class="format-btn" onclick="formatDoc('bold')">B</button>
                <button class="format-btn" onclick="formatDoc('italic')">I</button>
                <button class="format-btn" onclick="changeSize(1)">A+</button>
                <button class="format-btn" onclick="changeSize(-1)">A-</button>
                <div class="color-dot" style="background:#000000" onclick="formatDoc('foreColor','#000000')"></div>
                <div class="color-dot" style="background:#FF0000" onclick="formatDoc('foreColor','#FF0000')"></div>
                <div class="color-dot" style="background:#008000" onclick="formatDoc('foreColor','#008000')"></div>
                <div class="color-dot" style="background:#0000FF" onclick="formatDoc('foreColor','#0000FF')"></div>
                <button class="format-btn" onclick="document.getElementById('fileInp').click()">üì∑</button>
                <input type="file" id="fileInp" hidden accept="image/*" onchange="addPhoto(event)">
            </div>

            <div class="notebook-page" id="modalLines" contenteditable="true"></div>
        </div>
    </div>

    <div id="quickAddModal" class="modal">
        <div class="modal-content" style="height:auto; border-left:10px solid #1D4ED8; padding-bottom:20px;">
            <div style="background:#1D4ED8; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-weight:800;">üîî Yeni Etkinlik & Alarm</span>
                <button onclick="closeAllModals()" style="background:none; border:none; color:white; font-size:20px; font-weight:900; cursor:pointer;">‚úï</button>
            </div>
            <div style="padding:15px;">
                <input type="date" id="qaDate" class="prof-input">
                <input type="time" id="qaTime" class="prof-input">
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <button onclick="openIconPicker()" id="selectedIcon" class="circle-btn" style="min-width:50px;">üìÖ</button>
                    <input type="text" id="qaText" class="prof-input" style="margin-bottom:0; flex:1;" placeholder="Etkinlik adƒ±...">
                </div>
                <div id="repeatCountDiv" style="display:none; margin-top:10px;">
                    Ka√ß hafta s√ºrs√ºn? <input type="number" id="qaRepeatWeeks" class="prof-input" style="width:60px; display:inline; margin:0 5px;" value="4">
                </div>
                <div style="background: #f0f2f5; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                   <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="qaRepeat" onchange="document.getElementById('repeatCountDiv').style.display = this.checked ? 'block' : 'none'"> üîÑ Her hafta tekrarla
                    </label>
                    <label style="font-size: 13px; display: block;"><input type="checkbox" id="qaNotify"> üì± Bildirim Panelinde G√∂ster</label>
                    <label style="font-size: 13px; display: block;"><input type="checkbox" id="qaOverlay" checked> üñ•Ô∏è Ekran √úzerinde Uyarƒ±</label>
                </div>
                <select id="qaAlarmSound" class="prof-input"><option value="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">Melodi 1</option><option value="https://assets.mixkit.co/active_storage/sfx/1011/1011-preview.mp3">Melodi 2</option></select>
                <div style="display:flex; gap:10px;">
                    <button id="qaSaveBtn" class="primary-btn" style="flex:2;">TAKVƒ∞ME ƒ∞≈ûLE</button>
                    <button onclick="closeAllModals()" class="primary-btn" style="background:#ccc; color:#333; flex:1;">VAZGE√á</button>
                </div>
            </div>
        </div>
    </div>

    <div id="masterListModal" class="modal"><div class="modal-content"><header class="modal-header"><h2>üìä Planlƒ± Etkinlikler</h2><button class="arrow-btn" onclick="closeAllModals()">KAPAT</button></header><div style="flex:1; overflow-y:auto; padding:15px;"><table id="masterListContent"></table></div></div></div>
    <div id="iconPicker" class="modal"><div class="modal-content" style="height:auto;"><div id="iconGrid" style="display:grid; grid-template-columns:repeat(5,1fr); gap:10px; padding:20px;"></div></div></div>

    <script>
        let agenda = JSON.parse(localStorage.getItem('elite_pro_v2026')) || { events: [], notes: {}, profile: { pageFormat: 'f-lined' }, user: null };
        let currentWeekStart = new Date();
        let activeKey = null;
        let selectedIcon = "üìÖ";
        let currentFontSize = 3; 
        const trDays = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        const trMonths = ["Ocak", "≈ûubat", "Mart", "Nisan", "Mayƒ±s", "Haziran", "Temmuz", "Aƒüustos", "Eyl√ºl", "Ekim", "Kasƒ±m", "Aralƒ±k"];
        const icons = ["üè†","üõí","üßπ","üè•","üíº","üë®‚Äçüë©‚Äçüëß","‚úàÔ∏è","‚öΩ","ü§ù","üéì","üíª","üîë","üçï","üèãÔ∏è","üßò","üé®","üõ†Ô∏è","üì∏","üéÅ","üß™"];

        function updatePageFormat(val) { agenda.profile.pageFormat = val; saveData(); renderUI(); }

        function navigateDay(step) {
            agenda.notes[activeKey] = document.getElementById('modalLines').innerHTML;
            saveData();
            let d = new Date(activeKey);
            d.setDate(d.getDate() + step);
            openDay(toKey(d));
            renderUI();
        }

        function tryLogin() {
            const email = document.getElementById('logEmail').value;
            const pass = document.getElementById('logPass').value;
            if(email && pass.length > 3) { agenda.user = { email: email }; saveData(); checkAuth(); } 
            else { alert("Ge√ßerli bir giri≈ü yapƒ±n!"); }
        }

        function checkAuth() {
            if(agenda.user) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'flex';
            }
        }

        function formatDoc(cmd, val) { document.execCommand(cmd, false, val); }
        function changeSize(dir) { currentFontSize = Math.max(1, Math.min(7, currentFontSize + dir)); formatDoc('fontSize', currentFontSize); }

        function addPhoto(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (f) => {
                const img = document.createElement('img');
                img.src = f.target.result;
                img.tabIndex = 0; // Tƒ±klanabilir yaparak boyutlandƒ±rmayƒ± aktif eder
                document.getElementById('modalLines').appendChild(img);
            };
            reader.readAsDataURL(file);
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkAuth(); setMon(currentWeekStart); renderUI(); setupIcons(); loadProfileData();
            setInterval(checkAlarms, 30000);
            document.getElementById('themeToggle').onclick = () => {
                const b = document.body; b.setAttribute('data-theme', b.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
            };
        });

        function checkAlarms() {
            const now = new Date();
            const dateKey = toKey(now);
            const timeKey = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            agenda.events.forEach(ev => {
                if (ev.date === dateKey && ev.time === timeKey && !ev.fired) {
                    if(ev.overlay) triggerAlarm(ev);
                    ev.fired = true; saveData();
                }
            });
        }

        function triggerAlarm(ev) {
            const audio = document.getElementById('alarmAudio');
            audio.src = ev.sound || audio.src;
            audio.play().catch(()=>{});
            document.getElementById('alarmInfo').innerText = `${ev.icon} ${ev.text} - ${ev.time}`;
            document.getElementById('alarmOverlay').style.display = 'flex';
        }

        function stopAlarm() { document.getElementById('alarmAudio').pause(); document.getElementById('alarmOverlay').style.display = 'none'; }

        const toKey = (d) => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        function setMon(date) { let d = date.getDay(); let diff = date.getDate() - d + (d === 0 ? -6 : 1); date.setDate(diff); }

        function renderUI() {
            const grid = document.getElementById('weekGrid');
            if(!grid) return;
            grid.innerHTML = '';
            document.getElementById('dateDisplay').innerText = `${trMonths[currentWeekStart.getMonth()]} ${currentWeekStart.getFullYear()}`;
            document.getElementById('todayBanner').innerText = `${new Date().getDate()} ${trMonths[new Date().getMonth()]} ${trDays[new Date().getDay() === 0 ? 6 : new Date().getDay()-1]}`;

            const pf = agenda.profile.pageFormat || 'f-blank';

            for (let i = 0; i < 7; i++) {
                let d = new Date(currentWeekStart); d.setDate(currentWeekStart.getDate() + i);
                let key = toKey(d);
                let dayEvents = agenda.events.filter(ev => ev.date === key).sort((a,b) => a.time.localeCompare(b.time));
                
                // BURASI G√úNCELLENDƒ∞: Etkinlik ismi artƒ±k g√∂r√ºn√ºyor
                let eventHtml = dayEvents.map(ev => `<div class="day-event-item">${ev.icon} ${ev.time} - ${ev.text}</div>`).join('');

                const card = document.createElement('div');
                card.className = `day-card day-${i} ${i === 6 ? 'pazar-card' : ''} ${key === toKey(new Date()) ? 'is-today' : ''}`;
                card.innerHTML = `<div onclick="openDay('${key}')" style="cursor:pointer"><div class="d-num">${d.getDate()}</div><div class="d-name">${trDays[i]}</div></div>
                                  <div style="flex:1; overflow:hidden;">${eventHtml}</div>
                                  <div class="not-lines ${pf}" style="pointer-events:none; opacity:0.6;">
                                      ${agenda.notes[key] ? agenda.notes[key] : ''}
                                  </div>`;
                grid.appendChild(card);
            }
        }

        function openDay(key) {
            activeKey = key;
            const d = new Date(key); const idx = d.getDay() === 0 ? 6 : d.getDay() - 1;
            document.getElementById('modalFullHeader').innerText = `${d.getDate()} ${trMonths[d.getMonth()]} ${trDays[idx]}`;
            
            const dayEvents = agenda.events.filter(ev => ev.date === key).sort((a,b) => a.time.localeCompare(b.time));
            document.getElementById('dayEventsHeader').innerHTML = dayEvents.map(ev => `<span style="background:rgba(29, 78, 216, 0.1); padding:2px 6px; border-radius:10px; font-size:10px; font-weight:bold;">${ev.icon} ${ev.time} - ${ev.text}</span>`).join('');

            const ml = document.getElementById('modalLines');
            ml.innerHTML = agenda.notes[activeKey] || "";
            ml.className = "notebook-page " + (agenda.profile.pageFormat || 'f-blank');
            document.getElementById('dayModal').style.display = 'flex';
        }

        document.getElementById('saveDayBtn').onclick = () => { 
            agenda.notes[activeKey] = document.getElementById('modalLines').innerHTML; 
            saveData(); renderUI(); closeAllModals(); 
        };

        document.getElementById('qaSaveBtn').onclick = () => {
            const startDate = document.getElementById('qaDate').value;
            const repeat = document.getElementById('qaRepeat').checked;
            const weekCount = parseInt(document.getElementById('qaRepeatWeeks').value) || 1;
            if(!startDate || !document.getElementById('qaText').value) return alert("Eksik bilgi!");

            for(let i=0; i < (repeat ? weekCount : 1); i++) {
                let d = new Date(startDate);
                d.setDate(d.getDate() + (i * 7));
                const ev = { 
                    id: Date.now() + i, 
                    date: toKey(d), 
                    time: document.getElementById('qaTime').value, 
                    text: document.getElementById('qaText').value, 
                    icon: selectedIcon, 
                    overlay: document.getElementById('qaOverlay').checked, 
                    notify: document.getElementById('qaNotify').checked, 
                    sound: document.getElementById('qaAlarmSound').value, 
                    fired: false 
                };
                agenda.events.push(ev);
            }
            saveData(); renderUI(); closeAllModals();
        };

        function setupIcons() {
            icons.forEach(icon => {
                const div = document.createElement('div'); div.style.fontSize="30px"; div.style.cursor="pointer"; div.innerText = icon;
                div.onclick = () => { selectedIcon = icon; document.getElementById('selectedIcon').innerText = icon; closeIconPicker(); };
                document.getElementById('iconGrid').appendChild(div);
            });
        }

        function togglePanel() { document.getElementById('sidePanel').classList.toggle('active'); }
        function saveData() { localStorage.setItem('elite_pro_v2026', JSON.stringify(agenda)); }
        function closeAllModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function openIconPicker() { document.getElementById('iconPicker').style.display = 'flex'; }
        function closeIconPicker() { document.getElementById('iconPicker').style.display = 'none'; }
        
        document.getElementById('masterListBtn').onclick = () => {
            const cont = document.getElementById('masterListContent'); cont.innerHTML = "";
            const sorted = [...agenda.events].sort((a,b) => a.date.localeCompare(b.date));
            sorted.forEach(ev => {
                cont.innerHTML += `<tr>
                    <td>${ev.date}</td>
                    <td>${ev.time}</td>
                    <td>${ev.icon} ${ev.text}</td>
                    <td style="text-align:right;"><button onclick="deleteEvent(${ev.id})" style="border:none; background:none; cursor:pointer;">‚ùå</button></td>
                </tr>`;
            });
            document.getElementById('masterListModal').style.display = 'flex';
        };

        function deleteEvent(id) { agenda.events = agenda.events.filter(e => e.id !== id); saveData(); renderUI(); closeAllModals(); }
        document.getElementById('quickAddBtn').onclick = () => { 
            document.getElementById('qaDate').value = toKey(new Date()); 
            document.getElementById('qaRepeat').checked = false;
            document.getElementById('repeatCountDiv').style.display = 'none';
            document.getElementById('quickAddModal').style.display = 'flex'; 
        };
        document.getElementById('prevWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate() - 7); renderUI(); };
        document.getElementById('nextWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate() + 7); renderUI(); };
        
        function loadProfileData() { 
            let p = agenda.profile; 
            document.getElementById('profName').value = p.name || ""; 
            document.getElementById('profPhone').value = p.phone || ""; 
            document.getElementById('pageFormat').value = p.pageFormat || "f-lined";
            if(agenda.user) document.getElementById('profEmail').value = agenda.user.email; 
            if(p.img) document.getElementById('profImg').src = p.img; 
        }
        function saveProfile() { 
            agenda.profile = { 
                name: document.getElementById('profName').value, 
                phone: document.getElementById('profPhone').value, 
                img: document.getElementById('profImg').src,
                pageFormat: document.getElementById('pageFormat').value
            }; 
            saveData(); renderUI(); alert("Kaydedildi!"); 
        }
        function loadProfilePic(e) { const r = new FileReader(); r.onload = () => { document.getElementById('profImg').src = r.result; }; r.readAsDataURL(e.target.files[0]); }
        function handleLogout() { if(confirm("√áƒ±kƒ±≈ü?")) { agenda.user = null; saveData(); location.reload(); } }
    </script>
</body>
</html>